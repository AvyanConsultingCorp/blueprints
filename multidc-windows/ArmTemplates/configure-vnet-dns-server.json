{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "metadata": {
        "description": "The region to deploy the resources into"
      }
    },
    "vnetName": {
      "type": "string",
      "metadata": {
        "description": "The name of the Virtual Network to Create"
      }
    },
    "vnetAddressPrefixes": {
      "type": "array",
      "metadata": {
        "description": "The address range of the new VNET in CIDR format"
      }
    },
    "dnsServers": {
      "type": "array",
      "metadata": {
        "description": "The DNS address(es) of the DNS Server(s) used by the VNET"
      }
    },
    "vnetFrontendSubnet": {
      "type": "object",
      "metadata": {
        "description": "Name and prefix of the frontend subnet in the VNET. Please note, an additional subnet called GatewaySubnet will be created where the VirtualNetworkGateway will be deployed. The name of that subnet must not be changed from GatewaySubnet."
      }
    },
    "vnetBackendSubnetDc": {
      "type": "object",
      "metadata": {
        "description": "Name and prefix of the domain controller backend subnet in the VNET. Please note, an additional subnet called GatewaySubnet will be created where the VirtualNetworkGateway will be deployed. The name of that subnet must not be changed from GatewaySubnet."
      }
    },
    "vnetBackendSubnetSql": {
      "type": "object",
      "metadata": {
        "description": "Name and prefix of the SQL backend subnet in the VNET. Please note, an additional subnet called GatewaySubnet will be created where the VirtualNetworkGateway will be deployed. The name of that subnet must not be changed from GatewaySubnet."
      }
    },
    "vnetGatewaySubnet": {
      "type": "object",
      "metadata": {
        "description": "Name and prefix for the GatewaySubnet where the VirtualNetworkGateway will be deployed. This must be at least /29."
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('vnetName')]",
      "type": "Microsoft.Network/virtualNetworks",
      "location": "[parameters('location')]",
      "apiVersion": "2016-03-30",
      "properties": {
        "addressSpace": {
          "addressPrefixes": "[parameters('vnetAddressPrefixes')]"
        },
        "dhcpOptions": {
          "dnsServers": "[parameters('dnsServers')]"
        },
        "subnets": [
          {
            "name": "[parameters('vnetFrontendSubnet').name]",
            "properties": {
              "addressPrefix": "[parameters('vnetFrontendSubnet').prefix]"
            }
          },
          {
            "name": "[parameters('vnetBackendSubnetDc').name]",
            "properties": {
              "addressPrefix": "[parameters('vnetBackendSubnetDc').prefix]"
            }
          },
          {
            "name": "[parameters('vnetBackendSubnetSql').name]",
            "properties": {
              "addressPrefix": "[parameters('vnetBackendSubnetSql').prefix]"
            }
          },
          {
            "name": "[parameters('vnetGatewaySubnet').name]",
            "properties": {
              "addressPrefix": "[parameters('vnetGatewaySubnet').prefix]"
            }
          }
        ]
      },
      "tags": {
        "displayName": "Virtual network with Dns"
      }
    }
  ]
}
